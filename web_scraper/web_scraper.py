from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.firefox.options import Options
from termcolor import colored

class  WebScraper():
    def __init__(self) -> None:
        options = Options()
        options.add_argument('--headless')
        self.driver = webdriver.Firefox(options=options)

    def webscraper(self,url):
        # for holding elements found in a form
        self.input_found_in_forms=[]
        self.driver.get(url)
        print("")
        print(colored("WebScraper 101","light_cyan"))
        print("")
        print(colored("***************************************","light_yellow"))
        print(colored("------------------------------","light_cyan"))
        self.get_all_forms()
        print(colored("------------------------------","light_cyan"))
        print(colored("[$] loking for input.","light_yellow"))
        print(colored("------------------------------","light_cyan"))
        self.find_all_input_elements()
        
    
    def find_all_input_elements(self):

        try:
            # get all "input" fields
            input_fields = WebDriverWait(self.driver,10).until(
                EC.presence_of_all_elements_located((By.TAG_NAME,"input"))
            )
            if input_fields:
                for input_field in input_fields:
                    input_type = input_field.get_attribute('type')
                    input_name = input_field.get_attribute('name')
                    class_name = input_field.get_attribute('class')
                    id_name = input_field.get_attribute('id')
                    input_value = ""
                    if input_type == "hidden":
                        input_value = input_field.get_attribute('value')
                    result= colored(f"[+] Input type: {input_type}, Input name: {input_name}, Class_name: {class_name}, Id_name: {id_name}, value: {input_value}", "green")
                    if result not in self.input_found_in_forms:
                        print(result)
                    else:
                        print("not in form")
            else:
                print(colored(f"[-] Input not found", "light_red"))
        except Exception as e:
            print(colored(f"[ERROR] {e}","red"))

    def get_all_forms(self):
        try:
            # get all "forms"
            print(colored("[$] loking for forms.","light_yellow"))
            # all_forms = self.driver.find_elements(By.TAG_NAME, 'form')
            all_forms = WebDriverWait(self.driver,10).until(
                    EC.presence_of_all_elements_located((By.TAG_NAME,"form"))
                )
            if all_forms:
                for form in all_forms:
                    form_name = form.get_attribute("name")
                    form_method = form.get_attribute("method").upper()
                    form_action = form.get_attribute("action")
                    print(colored("------------------------------","light_cyan"))
                    print(colored(f"[+] Form name: {form_name}, Form method: {form_method}, Form action: {form_action}","green"))
                    # get all input elements within form 
                    form_input_elements = form.find_elements(By.TAG_NAME, "input")
                    if form_input_elements:
                        for input_element in form_input_elements:
                            input_element_type = input_element.get_attribute('type')
                            input_element_name = input_element.get_attribute('name')
                            input_element_class = input_element.get_attribute('class')
                            input_element_id = input_element.get_attribute('id')
                            input_value = ""
                            if input_element_type == "hidden":
                                input_value = input_element.get_attribute('value')

                            input_found = colored(f"[+] Input type: {input_element_type}, Input name: {input_element_name}, Class_name: {input_element_class}, Id_name: {input_element_id}, value: {input_value}", "green")
                            print(input_found)

                            self.input_found_in_forms.append(input_found)
                            
                    # form all buttons
                    form_button_elements = form.find_elements(By.TAG_NAME, "button")
                    if form_button_elements:
                        for form_button_element in form_button_elements:
                            button_text = form_button_element.text
                            print(colored("------------------------------","light_cyan"))
                            print(colored(f"[+] Button text: {button_text}","green"))
                            print("")                
            else:
                print(colored("[-] Form not found","light_red"))
        except Exception as e:
            print(colored(f"[ERROR] {e}","red"))

obj =   WebScraper()
obj.webscraper("http://testphp.vulnweb.com")